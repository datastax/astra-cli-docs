= Issue CQL commands with {cql-shell} in the {product}
:navtitle:  CQL quickstart

The {cql-shell} (`cqlsh`) is a utility that you can use to issue xref:astra@cql:reference:cql-quick-reference.adoc[{cql} commands] to your {astra-db} databases.

The {product} provides built-in `cqlsh` support by downloading and installing the `cqlsh` utility in the background, and then exposing it through the `xref:commands:astra-db-cqlsh.adoc[]` commands.
This is a command line-based alternative to the embedded {cql-console} in the {astra-ui}.

The `cqlsh` utility isn't installed by default with the {product}.
The first time you run an `astra db cqlsh` command, the {product} downloads and installs the `cqlsh` utility into the {product} home directory (`xref:ROOT:manage-cli.adoc#file-locations[~/.astra]`).

All `astra db cqlsh` commands require a database name or ID.
The first time you connect to a specific database, {product} downloads the database's {scb} into the {product} home directory.

For more information about CQL for {astra-db}, see xref:astra-db-serverless:cql:develop-with-cql.adoc[].

[#prerequisites]
== Prerequisites

The `cqlsh` commands require one of the following supported versions of Python with SSL/TLS:

* Python 3.6 to 3.11
* Python 2.7.12 or later

All other versions aren't supported.

Any supported Python version must be installed on your system _and_ available in your system's `PATH` for the {product} to use it with the `cqlsh` commands.
This version doesn't need to be your system's default Python version as long as it's available in the `PATH`.

=== Troubleshoot ModuleNotFoundError and Python installation errors

If the {product} reports `ModuleNotFoundError` after running any of the `astra db cqlsh` commands, make sure you have a <<prerequisites,supported Python version>> available in your system's `PATH`.

The error `A Python installation with SSL is required to connect to a cloud cluster` means that the detected Python version doesn't support TLS.
This typically happens with Python versions earlier than 2.7.12, which don't support TLS.

.Verify TLS support
[%collapsible]
====
To verify whether your current Python version supports TLS, run the following command:

[source,shell]
----
python -c 'from ssl import SSLContext, PROTOCOL_TLS, CERT_REQUIRED'
----

If TLS isn't supported, the following error is returned:

[source,console]
----
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: cannot import name PROTOCOL_TLS
----
====

== Start an interactive `cqlsh` session

Use the `xref:commands:astra-db-cqlsh-start.adoc[]` command to start `cqlsh` in interactive mode:

[source,shell,subs="+quotes"]
----
astra db cqlsh start **DB_ID**
----

.Result
[%collapsible]
====
[source,console]
----
[INFO] Patched cqlsh script to try known supported Python versions first
Connected to cndb at 127.0.0.1:9042.
[cqlsh 6.8.0 | Cassandra 4.0.0.6816 | CQL spec 3.4.5 | Native protocol v4]
Use HELP for help.
token@cqlsh>
----
====

To exit `cqlsh`, type `exit` or `quit;` and then press kbd:[Enter].

== Issue a CQL statement directly

Use the `xref:commands:astra-db-cqlsh-exec.adoc[]` command to issue a CQL statement directly from your terminal without starting an interactive `cqlsh` session:

[source,shell,subs="+quotes"]
----
astra db cqlsh exec **DB_ID** "describe keyspaces;"
----

.Result
[%collapsible]
====
[source,console]
----
system_auth    data_endpoint_auth  default_keyspace  system_views
my_keyspace    system              system_traces     system_virtual_schema
system_schema  datastax_sla        my_keyspace2
----
====

CQL statements must be enclosed in double quotes (`""`).

=== Execute a CQL file

Use the `-f` / `--file` option with the `xref:commands:astra-db-cqlsh-exec.adoc[]` command to execute a CQL file:

[source,shell,subs="+quotes"]
----
astra db cqlsh exec **DB_ID** -f sample.cql
----

.Example CQL file
[%collapsible]
====
.sample.cql
[source,cql]
----
-- Use a specific keyspace
USE default_keyspace;

-- Create a table
CREATE TABLE IF NOT EXISTS users (
    id UUID PRIMARY KEY,
    name TEXT,
    email TEXT
);

-- Insert some data
INSERT INTO users (id, name, email) VALUES (uuid(), 'Alice', 'alice@example.com');
INSERT INTO users (id, name, email) VALUES (uuid(), 'Bob', 'bob@example.com');

-- Query the data
SELECT * FROM users;
----
====

.Result
[%collapsible]
====
[source,console]
----
 id                                   | email             | name
--------------------------------------+-------------------+-------
 8b901d74-ac31-48e2-a403-dbcee8efe935 |   bob@example.com |   Bob
 0d712e1e-b764-4bbd-b587-579b75f29f32 | alice@example.com | Alice

(2 rows)
----
====

== Connect to a specific keyspace

Use the `-k` / `--keyspace` option with the `xref:commands:astra-db-cqlsh-start.adoc[]` and `xref:commands:astra-db-cqlsh-exec.adoc[]` commands to connect directly to a specific keyspace:

[source,shell,subs="+quotes"]
----
astra db cqlsh start **DB_ID** -k **KEYSPACE_NAME**
----

.Result
[%collapsible]
====
[source,console]
----
Connected to cndb at 127.0.0.1:9042.
[cqlsh 6.8.0 | Cassandra 4.0.0.6816 | CQL spec 3.4.5 | Native protocol v4]
Use HELP for help.
token@cqlsh:my_keyspace>
----
====

[source,shell,subs="+quotes"]
----
astra db cqlsh exec **DB_ID** -k **KEYSPACE_NAME** "DESC TABLES"
----

.Result
[%collapsible]
====
[source,console]
----
repairs              view_builds_in_progress  paxos           transferred_ranges
available_ranges     peers                    size_estimates
batches              compaction_history       built_views
prepared_statements  sstable_activity         range_xfers
"IndexInfo"          peer_events              local
----
====

////
TODO: Consider adding the following sections later:

1. Executing a statement from stdout
```
# Normal usage
echo "<stmt>" | astra db cqlsh DB

# or use - to explicitly specify that you're reading from stdin
echo "<stmt>" | astra db cqlsh DB -

# Or just type in what you want to into the terminal using `\` to create a new line
astra db cqlsh DB
```
2. Using the cqlsh binary directly
```
$(astra db cqlsh path) --version
```
3. A section that's just a list of links to the command references for the various `cqlsh` commands `astra` offers
////
